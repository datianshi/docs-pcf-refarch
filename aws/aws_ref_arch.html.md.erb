---
title: AWS Reference Architecture
owner: Customer0
---

This guide presents a reference architecture for <%= vars.product_name %>, including <%= vars.product_runtime %> (<%= vars.product_short %>) and <%= vars.pks_product_full %>, on Amazon Web Services (AWS). It builds on the common base architectures described in [Platform Architecture and Planning Overview](../index.html).

For general requirements for running <%= vars.product_name %> and specific requirements for running <%= vars.product_name %> on AWS, see [<%= vars.product_name %> on AWS Requirements](../../customizing/aws.html).


## <a id="pas"></a> <%= vars.product_short %>

This section describes a reference architecture for a <%= vars.product_short %> installation on AWS.

### <a id="diagram"></a> Diagram

The following diagram illustrates the reference architecture for <%= vars.product_short %> on AWS.

![This diagram illustrates <%= vars.product_short %> on AWS. For specific details about the components and communication represented by the diagram, see the base and AWS reference architectures.](PAS_AWS.png)

[View a larger version of this diagram](https://raw.githubusercontent.com/pivotal-cf/docs-pcf-refarch/master/images/PAS_AWS.png).

### <a id="networking"></a> Networking

The following sections provide guidance about networking resources.

#### <a id="dns"></a> DNS

You can use AWS Route 53 for DNS resolution to host your <%= vars.product_short %> domains.

#### <a id="lb"></a> Load Balancing

AWS offer Application Load Balancers (ALBs) and Network Load Balancers (NLBs). <%= vars.recommended_by %> recommends using NLBs because of the simplicity and security of leaving all encrypted traffic in place until it reaches the Gorouters. If you require Amazon Certificate Management or more complex layer 7 routing rules, you can front or replace the NLB with an ALB.

#### <a id="subnets"></a> Networks, Subnets, and IP Spacing Planning

The following list provides considerations related to networks, subnets, and IP spacing planning.

* In AWS, each AZ requires its own subnet of which the first 5 IPs are reserved.

* Your organization might not have the IP space necessary to deploy <%= vars.product_short %> in a consistent manner. To alleviate this, <%= vars.recommended_by %> recommends using the `100.64` address space to deploy a NAT instance and router so that the <%= vars.product_name %> deployment can use few IP addresses.

* If you want the front end of <%= vars.product_short %> to be accessible from your corporate network or the services running on <%= vars.product_short %> to be able to access corporate resources, you must either provide routable IPs to your VPC or use NAT.

* If you want a VPC that is only public-facing, no special consideration is necessary for the use of IPs.

* See the following table to understand the action required depending on the type of traffic you want to allow for your <%= vars.product_name %> deployment.
	<table>
		<tr>
			<th>If you want...</th>
			<th>then...</th>
		</tr>
		<tr>
			<td>Internet ingress</td>
			<td>Create the load balancers with Elastic IPs.</td>
		</tr>
		<tr>
			<td>Internet egress</td>
			<td>Create the NAT Gateway towards the internet.</td>
		</tr>
		<tr>
			<td>Corporate Ingress</td>
			<td>Create load balancers on your corporate subnet.</td>
		</tr>
		<tr>
			<td>Corporate Egress (For accessing corporate resources)</td>
			<td>Create the NAT instance on your corporate subnet or if business requirements dictate, make the entire VPC corporate-routable.</td>
		</tr>
	</table>

* If you plan to install [<%= vars.product_name %> Service Broker for AWS](https://docs.pivotal.io/aws-services/index.html), you might want to create another set of networks in addition to those outlined in the base reference architecture. This set of networks would be used for RDS and other AWS managed instances.

#### <a id="alternatives"></a> Alternative Network Layouts

The following options are available for choosing your network topology:

<table>
	<tr>
		<th>Type of Traffic</th>
		<th>Options</th>
	</tr>
	<tr>
		<td>Internet Ingress</td>
		<td><ul>
				<li>Allow internet ingress by associating load balancers with elastic IPs.</li>
				<li>Do not allow internet ingress.</li>
			</ul></td>
	</tr>
	<tr>
		<td>Internet Egress</td>
		<td>
			<ul>
				<li>Allow <%= vars.product_short %> to access the internet through a NAT gateway.</li>
				<li>Do not allow <%= vars.product_short %> to access the internet. Use only a corporate network.</li>
			</ul>
		</td>
	</tr>
	<tr>
		<td>Peering</td>
		<td><ul>
				<li>Isolated. This is normally internet-only facing.</li>
				<li>Peered with corporate or other VPCs through Transit Gateway.</li>
				<li>Peered directly with other VPCs and corporate connections.</li>
			</ul></td>
	</tr>
	<tr>
		<td>Corporate Peering</td>
		<td><ul>
				<li>SNAT for corporate resources. This requires 3 corporate IPs.</li>
				<li>Routable IP Addresses for VPC using /20 or a larger CIDR block necessary.</li>
			</ul></td>
	</tr>
</table>

### <a id="rds"></a> RDS

Use a single RDS instance for BOSH and <%= vars.product_short %>. This instance requires several databases. For more information, see the following sections of the installation documentation:

* [Step 3: Director Config Page](/platform/ops-manager/<%= vars.current_major_version.sub('.', '-') %>/aws/config-manual.html#pcfaws-om-dirconfig) in _Configuring BOSH Director on AWS_

* [External System Database Configuration](../../customizing/configure-pas.html#create-dbs) in _Configuring <%= vars.product_short %>_

### <a id="blobstore"></a> Blobstore Storage Accounts

Ops Manager requires a bucket for the BOSH blobstore.

<%= vars.product_short %> requires the following buckets:

* Buildpacks
* Droplets
* Packages
* Resources

These buckets require an associated role for read/write access.

### <a id="identity-management"></a> Identity Management

For identity management, use Instance Profiles whenever possible. For example, the **AWS Config Page** of the BOSH Director tile provides a **Use AWS Instance Profile** option. For more informationee [Step 2: AWS Config Page](/platform/ops-manager/<%= vars.current_major_version.sub('.', '-') %>/aws/config-manual.html#pcfaws-om-awsconfig).


## <a id="pks"></a> <%= vars.pks_product_short %>

This section describes a reference architecture for an <%= vars.pks_product_short %> installation on AWS.

### <a id="pks-diagram"></a> Diagram

The following diagram illustrates the reference architecture for <%= vars.pks_product_short %> on AWS.

![This diagram illustrates <%= vars.pks_product_short %> on AWS. For specific details about the components and communication represented by the diagram, see the base and AWS reference architectures.](../images/v2/export/PKS_AWS.png)

[View a larger version of this diagram](https://raw.githubusercontent.com/pivotal-cf/docs-pcf-refarch/master/images/v2/export/PKS_AWS.png).

### <a id="pks-networking"></a> Networking

The following sections provide guidance about networking resources.

#### <a id="pks-dns"></a> DNS

You can use AWS Route 53 for DNS resolution to host your <%= vars.pks_product_short %> domains.

#### <a id="pks-lb"></a> Load Balancing

You can configure a front end load balancer to enable public access to the <%= vars.pks_product_short %> API VM.

For each <%= vars.pks_product_short %> cluster, <%= vars.recommended_by %> recommends creating a load balancer for the corresponding master node or nodes. For more information, see [Creating and Configuring an AWS Load Balancer for <%= vars.pks_product_short %> Clusters](https://docs.pivotal.io/pks/aws-cluster-load-balancer.html).

For deployed workloads, Kubernetes can automatically create load balancers when applying the service definition to the app instances. For more information, see [Deploying and Exposing Basic Workloads](https://docs.pivotal.io/pks/deploy-workloads.html).

#### <a id="pks-subnets"></a> Networks, Subnets, and IP Spacing Planning

The following list provides considerations related to networks, subnets, and IP spacing planning.

* In AWS, each AZ requires its own subnet of which the first 5 IPs are reserved.

* If you want the front end of <%= vars.pks_product_short %> to be accessible from your corporate network or the services running on <%= vars.pks_product_short %> to be able to access corporate resources, you must either provide routable IPs to your VPC or use NAT.

* Create the <%= vars.pks_product_short %> subnets that host the Kubernetes cluster VMs with enough IP address capacity to accommodate the number of VMs and clusters you expect to deploy. The reference architecture diagram above shows a `/24` CIDR for the <%= vars.pks_product_short %> subnets, which allows for about 250 VMs per AZ. If you expect a larger number of clusters for your organization, consider defining larger subnets, such as `/20`, to make room for future growth.

#### <a id="pks-alternatives"></a> Alternative Network Layouts

The following options are available for choosing your network topology:

<table>
  <tr>
    <th>Type of Traffic</th>
    <th>Options</th>
  </tr>
  <tr>
    <td>Internet Ingress</td>
    <td><ul>
        <li>Allow internet ingress by associating load balancers with elastic IPs.</li>
        <li>Do not allow internet ingress.</li>
      </ul></td>
  </tr>
  <tr>
    <td>Internet Egress</td>
    <td>
      <ul>
        <li>Allow nodes and pods to access the internet through a NAT gateway.</li>
        <li>Do not allow nodes or pods to access the internet. Use only a corporate network.</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td>Peering</td>
    <td><ul>
        <li>Isolated. This is normally internet-only facing.</li>
        <li>Peered with corporate or other VPCs through Transit Gateway.</li>
        <li>Peered directly with other VPCs and corporate connections.</li>
      </ul></td>
  </tr>
  <tr>
    <td>Corporate Peering</td>
    <td><ul>
        <li>SNAT for corporate resources. This requires 3 corporate IPs.</li>
        <li>Routable IP Addresses for VPC using /20 or a larger CIDR block necessary.</li>
      </ul></td>
  </tr>
</table>

### <a id="pks-rds"></a> RDS

Use a single RDS instance for BOSH. This instance requires a database. For more information, see the [Step 3: Director Config Page](/platform/ops-manager/<%= vars.current_major_version.sub('.', '-') %>/aws/config-manual.html#pcfaws-om-dirconfig) section of the _Configuring BOSH Director on AWS_ topic.

### <a id="pks-id"></a> Identity Management

To create and manage Kubernetes master and worker nodes, use Instance Profiles. For more information, see the [Kubernetes Cloud Provider](https://docs.pivotal.io/pks/installing-pks-aws.html#cloud-provider) section of the _Installing <%= vars.pks_product_short %> on AWS_ topic.

For information about installing the required AWS constructs for <%= vars.pks_product_short %>, see [Installing <%= vars.product_name %> on AWS](../../customizing/aws.html).
